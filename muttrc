set mbox_type   = Maildir
set sendmail    = /usr/bin/msmtp

set folder      = ~/.mail/mobica
set spoolfile   = "+INBOX"
set mbox        = "+[Gmail]/All Mail"
set postponed   = "+[Gmail].Drafts"
unset record

mailboxes +INBOX \
            '+INBOX.bbags'\
            '+INBOX.Internal.Interviews'\
            '+INBOX.old'\
            '+INBOX.mplszczecin'\
            '+INBOX.notimportant'\
            '+INBOX.proj'\
            '+INBOX.proj.nokia-automotive'\
            '+INBOX.proj.nokia-automotive.nok01'\
            '+INBOX.mailing lists'\
            '+INBOX.mailing lists.genivi-ivi-layer-management'\
            '+INBOX.mailing lists.autmg'\
            '+INBOX.mailing lists.ivi-tizen'\
            '+TODO'\
            '+[Gmail].Sent Mail'

# main options
set realname   = "Bartosz Taczala"
set from       = "bartosz.taczala@mobica.com"
set mail_check = 0
set envelope_from

unset move           # gmail does that
set delete           # don't ask, just do
unset confirmappend  # don't ask, just do!
set quit             # don't ask, just do!!
unset mark_old       # read/new is good enough for me

# sort/threading
set sort     = threads
set sort_aux = reverse-last-date-received
set sort_re

# look and feel
set pager_index_lines = 10
set pager_context     = 5
set pager_stop
set menu_scroll
set smart_wrap
set tilde
set edit_headers = yes
set autoedit
unset markers
 #
# composing 
set fcc_attach
unset mime_forward
set forward_format = "Fwd: %s"
set include
set forward_quote
 #
ignore *                               # first, ignore all headers
unignore from: to: cc: date: subject:  # then, show only these
hdr_order from: to: cc: date: subject: # and in this order

set abort_nosubject=no
set sig_dashes = no # don't append -- as I use only my name as a sig
set attribution = " %n wrote:\n" # I don't like lengthy attributions as well
alternates '(username|altusername)([-+].*)?@.*' 
set hdr_format="%4C %Z %{%m/%d} %-15.15F (%4c) %s" # format of the index
source /usr/share/doc/mutt/colors/solarized/mutt-colors-solarized-dark-256.muttrc

ignore * 
unignore from subject to cc date x-mailer x-url user-agent
hdr_order from to cc date subject x-mailer user-agent

set sort=threads 
set sort_aux=last-date-received

# sidebar 
set sidebar_visible=yes
set sidebar_width=30
set sidebar_visible = yes
macro index b '<enter-command>toggle sidebar_visible<enter><refresh>'
macro pager b '<enter-command>toggle sidebar_visible<enter><redraw-screen>'
# ctrl-n, ctrl-p to select next, prev folder
# ctrl-o to open selected folder
bind index,pager \CP sidebar-prev
bind index,pager \CN sidebar-next
bind index,pager \CO sidebar-open
bind index R group-reply
macro index,pager gi <change-folder>=INBOX<enter>       "Go to inbox"
# Index Key Bindings ---------------------------------
bind index gg       first-entry
bind index G        last-entry
#
bind index R        group-reply
bind pager R        group-reply
bind index <tab>    sync-mailbox
bind index <space>  collapse-thread
bind index _        collapse-all
# Sync email
macro index O "<shell-escape>offlineimap<enter>"           "run offlineimap to sync all mail"
macro index o "<shell-escape>offlineimap -qf INBOX<enter>" "run offlineimap to sync inbox"
# task
macro index t "<pipe-message>~/dotfiles/mutt2task<enter> <copy-message>+TODO<enter>"
# add contact with 'gb' command
set query_command = "goobook query '%s'"
macro index,pager gb "<pipe-message>goobook add<enter><pipe-message>goobook reload<enter>" "add address to Google contacts"
bind editor <Tab> complete-query
macro index,pager c "<change-folder>?<toggle-mailboxes>" "open a different folder"

# gpg 
source ~/.mutt/gpg.rc
set pgp_use_gpg_agent = yes
set pgp_sign_as = 829911F6
set pgp_autosign 
# htmls mails
#
auto_view text/html .
alternative_order text/plain text/enriched text/html

set attribution     = "On %d, %n <%a> wrote:"
set date_format="%y-%m-%d %T"
set index_format="%2C | %Z [%d] %-30.30F (%-4.4c) %s"
set status_format   = "-%r-Mutt: %f [Msgs:%?M?%M/?%m%?n? New:%n?%?o? Old:%o?%?d? Del:%d?%?F? Flag:%F?%?t? Tag:%t?%?p? Post:%p?%?b? Inc:%b? %?l? %l?]---(%s/%S)-default-%>-(%P)---"

# notmuch
macro index <F8> \
    "<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
    <shell-escape>notmuch-mutt -r --prompt search<enter>\
    <change-folder-readonly>`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`<enter>\
    <enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
    "notmuch: search mail"

macro index <F9> \
    "<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
    <pipe-message>notmuch-mutt -r thread<enter>\
    <change-folder-readonly>`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`<enter>\
    <enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
    "notmuch: reconstruct thread"

macro index <F6> \
    "<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
    <pipe-message>notmuch-mutt tag -- -inbox<enter>\
    <enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
    "notmuch: remove message from inbox"

